<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <title>Generator BOT ANTAM - Stealth Pro 3.0 (Waktu Fix)</title>
    <style>
      :root {
        --bg: #0a0a0a;
        --card: #121212;
        --input: #1c1c1c;
        --border: #2a2a2a;
        --primary: #00f7a7;
        --text: #e9e9e9;
        --subtext: #b0b0b0;
      }
      body {
        background: var(--bg);
        color: var(--text);
        font-family: Inter, Arial, sans-serif;
        padding: 22px;
        max-width: 880px;
        margin: auto;
      }
      h1 {
        background: linear-gradient(90deg, #00f7a7, #00d0ff);
        -webkit-background-clip: text;
        color: transparent;
        font-size: 26px;
        text-align: center;
      }
      .box {
        background: var(--card);
        padding: 18px;
        border-radius: 12px;
        border: 1px solid var(--border);
        margin-top: 18px;
      }
      label {
        color: var(--subtext);
        display: block;
        margin-bottom: 6px;
      }
      input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: var(--input);
        color: var(--text);
        margin-bottom: 12px;
      }
      .bookmark-box {
        background: #101010;
        padding: 12px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid var(--border);
      }
      .bookmark-link {
        background: var(--primary);
        padding: 10px 18px;
        border-radius: 10px;
        color: #000;
        font-weight: 700;
        text-decoration: none;
        display: inline-block;
        cursor: grab; /* Menambahkan visualisasi untuk drag */
      }
      textarea {
        width: 100%;
        height: 320px;
        background: #0d0d0d;
        border: 1px solid var(--border);
        color: var(--primary);
        padding: 12px;
        border-radius: 10px;
        font-family: monospace;
        margin-top: 18px;
        resize: vertical;
      }
      .small {
        color: var(--subtext);
        font-size: 13px;
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <h1>âš¡ Generator BOT ANTAM</h1>

    <div class="box">
      <label>Jam Target (H)</label>
      <input
        id="jam"
        type="number"
        placeholder="Contoh: 6"
        min="0"
        max="23"
        value="6" />
      <label>Menit Target (M)</label>
      <input
        id="menit"
        type="number"
        placeholder="Contoh: 59"
        min="0"
        max="59"
        value="59" />
      <label>Detik Target (S)</label>
      <input
        id="detik"
        type="number"
        placeholder="Contoh: 58"
        min="0"
        max="59"
        value="58" />
    </div>

    <div class="box">
      <div class="bookmark-box">
        <a id="bookmarkBtn" class="bookmark-link" href="#">BOT ANTREAN ANTAM</a>
        <p class="small">
          **DRAG TOMBOL INI** ke Bookmark Bar Anda, lalu jalankan pada halaman
          antrean target.
        </p>
      </div>
      <textarea
        id="output"
        readonly
        placeholder="Kode bookmarklet akan muncul di sini..."></textarea>
    </div>

    <script>
      function generateBookmarklet() {
        // Ambil nilai input, pastikan valid dan default ke 0
        let H = document.getElementById("jam").value
          ? parseInt(document.getElementById("jam").value)
          : 0;
        let M = document.getElementById("menit").value
          ? parseInt(document.getElementById("menit").value)
          : 0;
        let S = document.getElementById("detik").value
          ? parseInt(document.getElementById("detik").value)
          : 0;

        // Pastikan input adalah angka yang valid dan dalam rentang (untuk keamanan)
        if (isNaN(H) || H < 0 || H > 23) H = 6;
        if (isNaN(M) || M < 0 || M > 59) M = 59;
        if (isNaN(S) || S < 0 || S > 59) S = 58;

        const code = `(function(){
/* ========== Stealth Pro 3.0 (Waktu Fix & Auto-Resume) ========== */
const rand = (a, b) => a + Math.random() * (b - a);
const humanDelay = () => Math.floor(rand(400, 1200));
const slowInterval = () => Math.floor(rand(900, 1800));
let pausedForCaptcha = false;

try { Object.defineProperty(navigator, 'webdriver', { get: () => undefined }); } catch (e) {}

/* ----- CAPTCHA DETECTION & PAUSE/RESUME ----- */

function detectCaptcha() {
    const captchaElement = document.querySelector('.g-recaptcha');
    if (captchaElement && getComputedStyle(captchaElement).display !== 'none') {
        const captchaResponse = document.querySelector('[name="g-recaptcha-response"]')?.value;
        return !captchaResponse || captchaResponse.length < 10; 
    }
    return false;
}

function pauseForCaptcha() {
    if (pausedForCaptcha) return;
    pausedForCaptcha = true;
    console.warn("ANTAM BOT: CAPTCHA DETECTED! Bot paused.");
}

/* ----- TIME LOGIC (FIXED) ----- */

function getTargetTime() {
    const TH = parseInt(localStorage.getItem('antam_TH'));
    const TM = parseInt(localStorage.getItem('antam_TM'));
    const TS = parseInt(localStorage.getItem('antam_TS'));
    
    if (isNaN(TH) || isNaN(TM) || isNaN(TS) || TH < 0 || TM < 0 || TS < 0) {
        return null; // Target waktu tidak valid atau belum disetel
    }

    return { TH, TM, TS };
}

function readClock() {
    try {
        // Clock element is ID 'clock' on the target page
        const el = document.querySelector('#clock');
        if (!el) return null;
        const parts = el.textContent.trim().split(':').map(n => parseInt(n));
        if (parts.length < 3) return null;
        return { h: parts[0], m: parts[1], s: parts[2] };
    } catch (e) {
        return null;
    }
}

/* ----- BUTTON FINDER & CLICKER ----- */
function naturalFindButtons() {
    try {
        const buttons = Array.from(document.querySelectorAll('button,input[type=button],a[role=button],a.btn'));
        const visible = buttons.filter(b => {
            try {
                const rect = b.getBoundingClientRect();
                if (rect.width < 6 || rect.height < 6) return false;
                const style = getComputedStyle(b);
                if (style.visibility === 'hidden' || style.display === 'none' || style.opacity === '0') return false;
                return true;
            } catch (e) {
                return false;
            }
        });
        // Target spesifik: Tombol dengan teks "Ambil Antrean"
        return visible.find(b => {
            const t = (b.innerText || b.value || '').toLowerCase();
            return t.includes('ambil antrean');
        }) || null;
    } catch (e) {
        return null;
    }
}

function humanClick(el) {
    try {
        const rect = el.getBoundingClientRect();
        const cx = rect.left + rect.width / 2 + (Math.random() * rect.width / 8 - rect.width / 16);
        const cy = rect.top + rect.height / 2 + (Math.random() * rect.height / 8 - rect.height / 16);
        ['pointerdown', 'mousedown'].forEach(t => el.dispatchEvent(new PointerEvent(t, { bubbles: true, clientX: cx, clientY: cy })));
        setTimeout(() => {
            ['pointerup', 'mouseup', 'click'].forEach(t => el.dispatchEvent(new MouseEvent(t, { bubbles: true, clientX: cx, clientY: cy })));
        }, Math.floor(rand(80, 240)));
    } catch (e) {
        try { el.click(); } catch (_) {}
    }
}

/* ----- MAIN LOOP ----- */
async function mainLoop() {
    // 1. Logika CAPTCHA
    if (detectCaptcha()) {
        pauseForCaptcha();
        return; 
    }
    if (pausedForCaptcha) {
        pausedForCaptcha = false; 
        console.log("ANTAM BOT: CAPTCHA solved, resuming automatically.");
    }
    
    // 2. Pembacaan dan Validasi Waktu Target
    const target = getTargetTime();
    if (!target) {
        console.log("ANTAM BOT: Waiting for target time to be set (H/M/S not valid in localStorage).");
        return setTimeout(mainLoop, slowInterval());
    }
    const { TH, TM, TS } = target;
    
    // 3. Pembacaan Waktu Sistem
    const t = readClock();
    if (!t) { 
        console.log("ANTAM BOT: Waiting for clock element (#clock) to be ready.");
        return setTimeout(mainLoop, humanDelay()); 
    }
    const { h, m, s } = t;

    // 4. Pengecekan Waktu (Logika Utama: H < TH atau (H==TH dan M < TM) atau (H==TH, M==TM, S < TS))
    if (h < TH || (h === TH && m < TM) || (h === TH && m === TM && s < TS)) {
        // Waktu sistem MASIH DI BAWAH waktu target, TUNGGU.
        console.log(\`ANTAM BOT: Waiting. Current time: \${h}:\${m}:\${s} < Target: \${TH}:\${TM}:\${TS}\`);
        return setTimeout(mainLoop, humanDelay() + Math.floor(Math.random() * 100));
    }

    // 5. Waktu Target TERCAPAI atau TERLEWAT, cari tombol.
    const btn = naturalFindButtons();
    if (!btn || btn.disabled) { 
        console.log("ANTAM BOT: Target time reached, but button not found or disabled. Retrying.");
        return setTimeout(mainLoop, humanDelay()); 
    }

    // 6. Final Delay dan Klik
    await new Promise(r => setTimeout(r, Math.floor(rand(150, 450))));

    if (detectCaptcha()) { pauseForCaptcha(); return; }

    humanClick(btn);
    console.log("ANTAM BOT: SUCCESS! Button clicked at target time!");

    // Clean up
    localStorage.removeItem('antam_TH'); localStorage.removeItem('antam_TM'); localStorage.removeItem('antam_TS');
    try { bgTimers.forEach(id => clearInterval(id)); } catch (e) {}
    clearInterval(loopInterval);
}

/* 7. Start Periodic Loop & Set Target Time */
// SET TARGET TIME KE LOCAL STORAGE (DIPERLUKAN UNTUK BOT)
localStorage.setItem('antam_TH', ${H});
localStorage.setItem('antam_TM', ${M});
localStorage.setItem('antam_TS', ${S});

const loopInterval = setInterval(mainLoop, 350 + Math.floor(Math.random() * 300));
setTimeout(mainLoop, 800);

// Human-like interactions
let bgTimers = [];
bgTimers.push(setInterval(() => {
    document.dispatchEvent(new MouseEvent('mousemove', { clientX: Math.random() * innerWidth, clientY: Math.random() * innerHeight, bubbles: true }));
}, slowInterval()));
bgTimers.push(setInterval(() => {
    window.scrollBy({ top: Math.random() * 8 - 4, behavior: 'smooth' });
}, slowInterval() + 300));

})();`;

        // Mengkodekan code sebagai bookmarklet
        const bookmarklet = "javascript:" + encodeURIComponent(code);

        // Memperbarui tombol dan textarea
        document.getElementById("bookmarkBtn").href = bookmarklet;
        document.getElementById("output").value = code;
      }

      // Memanggil generator secara periodik agar kode terupdate real-time saat user mengubah input
      setInterval(generateBookmarklet, 400);

      // Panggil sekali saat load
      generateBookmarklet();
    </script>
  </body>
</html>
